<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입</title>
    <script src="../app.js"></script> 
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
        function sample6_execDaumPostcode() {
            new daum.Postcode({
                oncomplete: function(data) {
                    // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.
    
                    // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                    // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                    var addr = ''; // 주소 변수
                    
    
                    //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                    if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                        addr = data.roadAddress;
                    } else { // 사용자가 지번 주소를 선택했을 경우(J)
                        addr = data.jibunAddress;
                    }
    
                    // 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
                    if(data.userSelectedType === 'R'){
                        // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                        // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                        if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
                            extraAddr += data.bname;
                        }
                        // 건물명이 있고, 공동주택일 경우 추가한다.
                        if(data.buildingName !== '' && data.apartment === 'Y'){
                            extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                        }                        
                    }

                    // 우편번호와 주소 정보를 해당 필드에 넣는다.
                    document.getElementById('zipcode').value = data.zonecode;
                    document.getElementById("address1").value = addr;
                    // 커서를 상세주소 필드로 이동한다.
                    document.getElementById("address2").focus();
                }
            }).open();
        }

        window.onload = function(){
            const ssn1 = document.getElementById('ssn1');
            ssn1.addEventListener('keyup', () => {
                if(ssn1.value.length >= 6){
                    document.getElementById('ssn2').focus();
                };
        });

            const ssn = document.querySelectorAll('.ssn');
            ssn.forEach((s) => {
                // console.log(s);
                s.addEventListener('input', () => {
                    document.getElementById('ssncheck').value = 'n';
                });
            });
        };

        // 주민등록번호 검증함수
        function checkSSN(){    
            const ssn1 = document.getElementById('ssn1');
            const ssn2 = document.getElementById('ssn2');

            const ssn = ssn1.value + ssn2.value;
            const key = [2, 3, 4, 5, 6, 7, 8, 9, 2, 3, 4, 5];

            let total = 0;

            for (let i=0; i<key.length; i++){
                total += parseInt(ssn[i]) * key[i];
            };

            let result = total % 11;
            result = 11 - result;
            if(result >= 10) result = result % 10;

            if(result == ssn[12]){
                alert('유효한 주민등록번호입니다!');
                document.getElementById('ssncheck').value = 'y';
            }else{
                alert('유효하지 않은 주민등록번호입니다')
            };
        }

        // 회원가입 양식 확인
        function sendit(){
            const userid = document.getElementById('userid');
            const userpw = document.getElementById('userpw');
            const userpw_re = document.getElementById('userpw_re');
            const name = document.getElementById('name');
            const hp = document.getElementById('hp');
            const email = document.getElementById('email');
            const ssncheck = document.getElementById('ssncheck');
            const checkbtn = document.getElementById('checkbtn');
            const expIdText = /^[A-za-z0-9]{4,20}$/;
            const expPwText = /^(?=.*[A-Za-z])(?=.*[!@#$%^&*+=-])(?=.*[0-9]).{4,20}$/;
            const expNameText = /^[가-힣]+$/;
            const expHpText = /^\d{3}\d{3,4}\d{4}$/;
            const expEmailText = /^[A-Za-z0-9\-\.\_]+@[A-Za-z0-9\-]+\.[A-Za-z]+$/;

            if(!expIdText.test(userid.value)){
                alert('아이디는 4자이상 20자이하의 영문자, 숫자로 입력하세요');
                userid.focus();
                return false;
            };

            if(!expPwText.test(userpw.value)){
                alert('비밀번호는 4자이상 20자이하의 영문자, 숫자, 특수문자를 1자 이상 꼭 포함해야합니다');
                userpw.focus();
                return false;
            };

            if(userpw.value != userpw_re.value){
                alert('비밀번호와 비밀번호 확인이 일치하지 않습니다');
                userpw_re.focus();
                return false;
            };

            if(!expNameText.test(name.value)){
                alert('이름은 한글로 입력하세요');
                name.focus();
                return false;
            };

            if(!expHpText.test(hp.value)){
                alert('휴대폰번호 형식이 일치하지 않습니다');
                hp.focus();
                return false;
            };

            if(!expEmailText.test(email.value)){
                alert('이메일 형식이 일치하지 않습니다');
                email.focus();
                return false;
            };

            if(ssncheck.value == 'n'){
                alert('주민등록번호 유효성검사를 해주세요');
                checkbtn.focus();
                return false;
            };
            return true;
        };
    </script>
</head>
<body>
    <h2>회원가입</h2>
    <form method="post" action="/process/register" name="regform" id="regform" method="post" onsubmit="return sendit()">
        <input type="hidden" name="ssncheck" id="ssncheck" value="n">   
            <table></table>
                <p>아이디: <input type="text" name="userid" id="userid" maxlength="20"></p>

                <p>비밀번호: <input type="password" name="userpw" id="userpw" maxlength="20"></p>

                <p>비밀번호 확인: <input type="password" name="userpw_re" id="userpw_re" maxlength="20"></p>

                <p>이름: <input type="text" name="name" id="name" maxlength="20"></p>

                <p>휴대폰번호: <input type="text" name="hp" id="hp" maxlength="20"></p>

                <p>이메일: <input type="text" name="email" id="email" maxlength="50"></p>
                
                <p>성별: <label for="male">남자</label><input type="radio" name="gender" id="gender" checked>
                        <label for="female">여자</label><input type="radio" name="gender" id="gender" value="여자">
                </p>

                <p>주민등록번호: 
                    <input type="text" name="ssn1" id="ssn1" maxlength="6" class="ssn"> 
                     - <input type="password" name="ssn2" id="ssn2" maxlength="7" class="ssn">
                    <button type="button" onclick="checkSSN()" id="checkbtn">주민등록번호검증</button>
                </p>

                <p>우편번호: 
                    <input type="text" name="zipcode" maxlength="5"  id="zipcode" placeholder="우편번호">
                    <button type="button" onclick="sample6_execDaumPostcode()">우편번호 찾기</button></p>

                <p>주소: <input type="text" name="address1"  id="address1" placeholder="주소"></p>

                <p>상세주소: <input type="text" name="address2" id="address2" placeholder="상세주소"></p>
            </table>
            <p><input type="submit" value="회원가입">
        </form>
</body>
</html>